<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Solo – Bermuda Tournament (Admin settings)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#071026;color:#e6eef6;font-family:Inter,Arial,Helvetica,sans-serif}
  :root{
    --primary:#16a34a;
    --accent:#2563eb;
    --card-bg: rgba(2,6,23,0.86);
    --muted:#9ca3af;
    --glass: linear-gradient(180deg, rgba(10,20,30,0.6), rgba(2,6,23,0.8));
  }
  header{padding:16px;text-align:center;background:var(--card-bg);border-bottom:1px solid rgba(255,255,255,0.03)}
  header h1{margin:0;color:#9be7ff}
  header p{margin:6px 0 0;color:var(--muted);font-size:13px}
  .container{max-width:1100px;margin:18px auto;padding:12px}
  .row{display:flex;gap:14px;flex-wrap:wrap}
  .col{flex:1;min-width:300px}
  .card{background:var(--glass);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(0,0,0,0.5);overflow:hidden}
  h2{margin:0 0 8px;color:#8fe0ff}
  p{margin:6px 0;color:var(--muted);font-size:13px}
  label{display:block;color:var(--muted);font-size:13px;margin-top:8px}
  input[type="text"],input[type="number"],input[type="datetime-local"],select,textarea{
    width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#061024;color:#e6eef6;margin-top:6px;font-size:14px
  }
  .btn{display:inline-block;padding:10px 14px;border-radius:9px;border:none;cursor:pointer;font-weight:700}
  .btn-primary{background:var(--primary);color:#04200e}
  .btn-accent{background:var(--accent);color:#eaf2ff}
  .btn-danger{background:#dc2626;color:#fff}
  .small{font-size:12px;color:var(--muted)}
  .table-wrap{overflow-x:auto;margin-top:10px}
  table{width:100%;border-collapse:collapse;min-width:680px}
  th,td{padding:8px;border:1px solid rgba(255,255,255,0.03);text-align:left;font-size:13px}
  th{background:rgba(10,20,30,0.6);color:#aeefff}
  .status-paid{background:#16a34a;color:#04200e;padding:6px;border-radius:6px;font-weight:700}
  .status-pending{background:#f97316;color:#2b0500;padding:6px;border-radius:6px;font-weight:700}
  .settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media(max-width:780px){ .settings-grid{grid-template-columns:1fr} .row{flex-direction:column} table{min-width:520px}}
</style>
</head>
<body>
<header>
  <h1 id="titleHeader">Solo – Bermuda (Tournament)</h1>
  <p id="subtitle">Entry ₹25 • Winners & kill rewards • Admin: add ?admin=1</p>
</header>

<div class="container">

  <div class="row">
    <!-- LEFT COLUMN: Info + Register + Players -->
    <div class="col">
      <div class="card" id="infoCard">
        <h2>Tournament Info</h2>
        <div class="small">Mode: <span id="infoMode">Solo</span> • Map: <span id="infoMap">Bermuda</span></div>
        <p style="margin-top:8px;"><strong>Entry:</strong> ₹<span id="infoFee">25</span> &nbsp; • &nbsp; <strong>Prizes:</strong> ₹<span id="infoP1">150</span> / ₹<span id="infoP2">100</span> / ₹<span id="infoP3">50</span> &nbsp; • &nbsp; <strong>Per kill:</strong> ₹<span id="infoKill">6</span></p>
        <p class="small">UPI: <span id="infoUPI">aryangaming603-2@okicici</span></p>
        <p id="slotsInfo" class="small">Slots: <span id="slotCount">48</span> • Filled: <span id="filledCount">0</span></p>
      </div>

      <div class="card" id="registerCard">
        <h2>Register & Pay</h2>
        <div id="regNotice" class="small">Registration is <b id="regStatus">OPEN</b>. Click to generate payment code and open UPI.</div>
        <label>Free Fire Name</label><input id="ffName" type="text" placeholder="Your in-game name">
        <label>UID</label><input id="ffUid" type="text" placeholder="Free Fire UID">
        <label>WhatsApp</label><input id="ffWa" type="text" placeholder="WhatsApp number">
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn btn-primary" onclick="payAndRegister()">Pay & Register</button>
        </div>
        <p class="small" style="margin-top:8px">Note: Payment note must include the generated code to identify the player.</p>
      </div>

      <div class="card">
        <h2>Registered Players</h2>
        <div class="table-wrap">
          <table>
            <thead><tr><th>#</th><th>Name</th><th>UID</th><th>WhatsApp</th><th>Code</th><th>Status / Actions</th></tr></thead>
            <tbody id="playerList"></tbody>
          </table>
        </div>
        <p class="small" id="playersNotice" style="margin-top:8px">Players stored in browser (local). Admin can manage entries.</p>
      </div>
    </div>

    <!-- RIGHT COLUMN: Admin Settings + Leaderboard -->
    <div class="col">
      <div class="card" id="adminSettingsCard" style="display:none">
        <h2>Admin Settings</h2>
        <p class="small">Change any tournament parameter and press Save → changes apply immediately to page (no code editing needed).</p>

        <div class="settings-grid">
          <div>
            <label>Tournament Name</label><input id="setName" type="text">
          </div>
          <div>
            <label>Mode</label><input id="setMode" type="text" placeholder="Solo / Duo / Squad">
          </div>

          <div>
            <label>Map</label><input id="setMap" type="text">
          </div>
          <div>
            <label>Total Slots</label><input id="setSlots" type="number" min="1">
          </div>

          <div>
            <label>Entry Fee (₹)</label><input id="setFee" type="number" min="0">
          </div>
          <div>
            <label>Is Free?</label>
            <select id="setFree"><option value="0">No (Paid)</option><option value="1">Yes (Free)</option></select>
          </div>

          <div>
            <label>Winner 1 (₹)</label><input id="setP1" type="number" min="0">
          </div>
          <div>
            <label>Winner 2 (₹)</label><input id="setP2" type="number" min="0">
          </div>

          <div>
            <label>Winner 3 (₹)</label><input id="setP3" type="number" min="0">
          </div>
          <div>
            <label>Per Kill (₹)</label><input id="setKill" type="number" min="0">
          </div>

          <div>
            <label>UPI ID</label><input id="setUpi" type="text">
          </div>
          <div>
            <label>Registration</label>
            <select id="setReg"><option value="1">Open</option><option value="0">Closed</option></select>
          </div>

          <div>
            <label>Countdown / Match Start (optional)</label>
            <input id="setCountdown" type="datetime-local">
          </div>
          <div>
            <label>Theme Color (Primary)</label>
            <input id="setColor" type="color" value="#16a34a">
          </div>

        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn btn-accent" onclick="saveSettings()">Save Settings</button>
          <button class="btn btn-grey" onclick="resetSettings()">Reset to defaults</button>
          <button class="btn btn-danger" onclick="clearAllData()">Clear Players & Leaderboard</button>
        </div>
        <p class="small" style="margin-top:8px">Settings saved to browser storage — they apply instantly on this device/browser.</p>
      </div>

      <div class="card">
        <h2>Leaderboard (Solo)</h2>
        <p class="small">Top 3 prizes show automatically. Admin can add/edit/remove results via admin panel below.</p>

        <div id="lbAdmin" style="display:none">
          <label>Player name</label><input id="lbName" type="text">
          <label>Kills</label><input id="lbKills" type="number">
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn btn-accent" onclick="lbAdd()">Add</button>
            <button class="btn btn-grey" onclick="lbClear()">Reset LB</button>
          </div>
        </div>

        <div class="table-wrap" style="margin-top:10px">
          <table>
            <thead><tr><th>Rank</th><th>Name</th><th>Kills</th><th>Reward</th></tr></thead>
            <tbody id="lbTable"></tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
/* ======== Defaults & storage keys ======== */
const SETTINGS_KEY = "ffSettings_v2";
const PLAYERS_KEY = "ffPlayers_v2";
const LB_KEY = "ffLB_v2";

const DEFAULTS = {
  name: "Solo – Bermuda",
  mode: "Solo",
  map: "Bermuda",
  slots: 48,
  fee: 25,
  isFree: false,
  regOpen: true,
  p1: 150,
  p2: 100,
  p3: 50,
  perKill: 6,
  upi: "aryangaming603-2@okicici",
  countdown: "" , // ISO datetime or empty
  primary: "#16a34a"
};

/* state */
let settings = {};
let players = JSON.parse(localStorage.getItem(PLAYERS_KEY) || "[]");
let leaderboard = JSON.parse(localStorage.getItem(LB_KEY) || "[]");

/* admin check */
const IS_ADMIN = window.location.search.includes("admin=1");

/* ======== Settings functions ======== */
function loadSettings(){
  try{
    const s = JSON.parse(localStorage.getItem(SETTINGS_KEY));
    settings = s && typeof s === "object" ? {...DEFAULTS, ...s} : {...DEFAULTS};
  }catch(e){ settings = {...DEFAULTS}; }
  applySettingsToUI();
  applyTheme();
}

function saveSettings(){
  // read from inputs
  settings.name = document.getElementById("setName").value || DEFAULTS.name;
  settings.mode = document.getElementById("setMode").value || DEFAULTS.mode;
  settings.map = document.getElementById("setMap").value || DEFAULTS.map;
  settings.slots = parseInt(document.getElementById("setSlots").value) || DEFAULTS.slots;
  settings.fee = Number(document.getElementById("setFee").value) || DEFAULTS.fee;
  settings.isFree = document.getElementById("setFree").value === "1";
  settings.p1 = Number(document.getElementById("setP1").value) || DEFAULTS.p1;
  settings.p2 = Number(document.getElementById("setP2").value) || DEFAULTS.p2;
  settings.p3 = Number(document.getElementById("setP3").value) || DEFAULTS.p3;
  settings.perKill = Number(document.getElementById("setKill").value) || DEFAULTS.perKill;
  settings.upi = document.getElementById("setUpi").value || DEFAULTS.upi;
  settings.regOpen = document.getElementById("setReg").value === "1";
  settings.countdown = document.getElementById("setCountdown").value || "";
  settings.primary = document.getElementById("setColor").value || DEFAULTS.primary;

  localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
  applySettingsToUI();
  applyTheme();
  alert("Settings saved ✅");
}

function resetSettings(){
  if(!confirm("Reset settings to defaults?")) return;
  settings = {...DEFAULTS};
  localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
  applySettingsToUI();
  applyTheme();
  alert("Defaults restored");
}

function applySettingsToUI(){
  // fill UI text values based on settings object
  document.getElementById("titleHeader").textContent = settings.name + " (Tournament)";
  document.getElementById("subtitle").textContent = `${settings.mode} • ${settings.map} • Entry ₹${settings.fee}`;

  document.getElementById("infoMode").textContent = settings.mode;
  document.getElementById("infoMap").textContent = settings.map;
  document.getElementById("infoFee").textContent = settings.fee;
  document.getElementById("infoP1").textContent = settings.p1;
  document.getElementById("infoP2").textContent = settings.p2;
  document.getElementById("infoP3").textContent = settings.p3;
  document.getElementById("infoKill").textContent = settings.perKill;
  document.getElementById("infoUPI").textContent = settings.upi;
  document.getElementById("slotCount").textContent = settings.slots;
  document.getElementById("regStatus").textContent = settings.regOpen ? "OPEN" : "CLOSED";

  // show/hide registration UI
  document.getElementById("registerCard").style.display = settings.regOpen ? "block" : "none";

  // fill admin inputs (if admin)
  if(IS_ADMIN){
    document.getElementById("setName").value = settings.name;
    document.getElementById("setMode").value = settings.mode;
    document.getElementById("setMap").value = settings.map;
    document.getElementById("setSlots").value = settings.slots;
    document.getElementById("setFee").value = settings.fee;
    document.getElementById("setFree").value = settings.isFree ? "1" : "0";
    document.getElementById("setP1").value = settings.p1;
    document.getElementById("setP2").value = settings.p2;
    document.getElementById("setP3").value = settings.p3;
    document.getElementById("setKill").value = settings.perKill;
    document.getElementById("setUpi").value = settings.upi;
    document.getElementById("setReg").value = settings.regOpen ? "1" : "0";
    document.getElementById("setCountdown").value = settings.countdown || "";
    document.getElementById("setColor").value = settings.primary;
  }
}

/* theme apply */
function applyTheme(){
  document.documentElement.style.setProperty('--primary', settings.primary || DEFAULTS.primary);
}

/* ===== Players (register/persist) ===== */
function savePlayers(){ localStorage.setItem(PLAYERS_KEY, JSON.stringify(players)); }
function saveLB(){ localStorage.setItem(LB_KEY, JSON.stringify(leaderboard)); }

function payAndRegister(){
  if(!settings.regOpen){ alert("Registration is closed."); return; }
  let name = document.getElementById("ffName").value.trim();
  let uid = document.getElementById("ffUid").value.trim();
  let wa = document.getElementById("ffWa").value.trim();
  if(!name || !uid || !wa){ alert("Fill name, UID & WhatsApp."); return; }
  if(players.length >= settings.slots){ alert("Slots full."); return; }

  const code = "FF" + Math.floor(100000 + Math.random()*900000);
  const entry = {name, uid, wa, code, status: settings.isFree ? "Paid" : "Pending", ts: Date.now()};
  players.push(entry);
  savePlayers();
  renderPlayers();
  updateCounts();

  // clear inputs
  document.getElementById("ffName").value ="";
  document.getElementById("ffUid").value ="";
  document.getElementById("ffWa").value ="";

  // if free - no UPI. else open UPI
  if(!settings.isFree){
    alert("Payment code: " + code + "\nUPI will open. Put this code in remark.");
    const upiUrl = "upi://pay?pa=" + encodeURIComponent(settings.upi)
                  + "&pn=" + encodeURIComponent(settings.name)
                  + "&am=" + encodeURIComponent(settings.fee)
                  + "&cu=INR&tn=" + encodeURIComponent(code);
    window.location.href = upiUrl;
  } else {
    alert("Registered (free entry) — your code: " + code);
  }
}

/* render players table */
function renderPlayers(){
  const tbody = document.getElementById("playerList");
  tbody.innerHTML = "";
  players.forEach((p,i)=>{
    const statusHtml = IS_ADMIN
      ? `<button class="status-paid" onclick="togglePaid(${i})">${p.status}</button>`
      : `<span class="small">${p.status}</span>`;

    const adminActions = IS_ADMIN ? `
      <div style="margin-top:6px;display:flex;gap:6px;flex-wrap:wrap">
        <button class="btn btn-accent" onclick="editPlayer(${i})">Edit</button>
        <button class="btn btn-danger" onclick="removePlayer(${i})">Remove</button>
      </div>` : "";

    const tr = document.createElement("tr");
    tr.innerHTML = `<td style="text-align:center">${i+1}</td>
      <td>${escapeHtml(p.name)}</td>
      <td>${IS_ADMIN?escapeHtml(p.uid):"XXXXXXX"}</td>
      <td>${IS_ADMIN?escapeHtml(p.wa):"XXXXXXXXXX"}</td>
      <td
