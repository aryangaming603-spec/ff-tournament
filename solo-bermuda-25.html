<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>EXIST GAMER — Solo Tournament</title>

<style>
:root{
  --bg:linear-gradient(180deg,#031026 0%, #071423 100%);
  --panel:#082034;
  --muted:#9fbfcc;
  --accent1:#06b6d4;
  --accent2:#16a34a;
  --danger:#ef4444;
  --glass:rgba(255,255,255,0.03);
  --radius:12px;
  --pad:14px;
  --maxw:1100px;
  --card-shadow: 0 10px 30px rgba(0,0,0,0.55);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:#eafcff}
.container{max-width:var(--maxw);margin:18px auto;padding:18px}
.header{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
.brand h1{margin:0;font-size:22px}
.brand p{margin:4px 0 0 0;color:var(--muted);font-size:13px}
.card{background:var(--panel);border-radius:var(--radius);padding:var(--pad);border:1px solid var(--glass);box-shadow:var(--card-shadow);margin-top:14px}
.row{display:grid;grid-template-columns:1fr 360px;gap:14px}
@media(max-width:880px){ .row{grid-template-columns:1fr} }
.muted{color:var(--muted);font-size:13px}
.kv{font-weight:700;color:#fff}
.info-block{display:flex;flex-direction:column;gap:6px}
.small{font-size:13px;color:var(--muted)}
.input, input, select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(2,12,20,0.6);color:#eaffff;margin-top:6px}
.btn{padding:10px 12px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
.btn-primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#02120a}
.btn-ghost{background:transparent;color:#bfefff;border:1px solid rgba(255,255,255,0.04)}
.btn-danger{background:var(--danger);color:#fff}
.controls{display:flex;gap:8px;flex-wrap:wrap}
.hint{font-size:12px;color:var(--muted);margin-top:6px}

/* Table responsive wrapper + prevent overflow */
.table-wrap{
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
  width:100%;
}
.table-wrap table{
  width:100%;
  border-collapse:collapse;
  table-layout:auto;
}
.table-wrap th, .table-wrap td{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,0.04);
  text-align:center;
  vertical-align:middle;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:260px;
}
.table-wrap td.wrap-allow{
  white-space:normal;
  word-break:break-word;
  max-width:300px;
  text-align:left;
}
.table-wrap th{color:var(--muted);font-weight:700;font-size:13px}

/* admin hidden by default */
.admin-only{ display:none !important; }

/* mobile: compact table (no horizontal scroll) */
@media (max-width:700px){
  .table-wrap{ overflow-x:hidden; }
  .table-wrap table{ table-layout:fixed; font-size:13px; }
  .table-wrap thead th{ padding:8px 6px; font-size:12px; white-space:nowrap; }
  .table-wrap td, .table-wrap th { padding:8px 6px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; vertical-align:middle; }
  .table-wrap td:nth-child(1){ width:6%; }
  .table-wrap td:nth-child(2){ width:28%; }
  .table-wrap td:nth-child(3){ width:18%; }
  .table-wrap td:nth-child(4){ width:18%; }
  .table-wrap td:nth-child(5){ width:14%; }
  .table-wrap td:nth-child(6){ width:10%; }
  .table-wrap td:nth-child(7){ width:12%; }
  .table-wrap td .btn{ padding:6px 8px; font-size:12px; display:inline-block; margin:0 3px 4px 0; }
  .table-wrap td .status-paid, .table-wrap td .status-pend { font-size:12px; padding:6px 8px; }
}

/* small badges */
.bad{background:#1f2937;color:#fff;padding:6px 8px;border-radius:999px;font-weight:700}
.status-paid{background:#134e4a;color:#d1fae5;padding:6px 8px;border-radius:8px;font-weight:700}
.status-pend{background:#44337a;color:#f3e8ff;padding:6px 8px;border-radius:8px;font-weight:700}

/* floating admin button (hidden when admin active) */
#adminFloating {
  position:fixed; right:12px; bottom:12px; z-index:9999; padding:10px 12px;
  border-radius:10px; border:none; font-weight:700; cursor:pointer;
  background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#02120a;
}
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <div class="brand">
      <h1>EXIST GAMER</h1>
      <p class="muted">Solo • Bermuda — tournament page</p>
    </div>

    <div style="text-align:right">
      <div class="muted">Tools</div>
      <div style="margin-top:8px">
        <!-- Admin opens via PIN prompt -->
        <button class="btn btn-ghost" onclick="tryAdmin()">Admin</button>
        <a class="btn btn-ghost" href="leaderboard.html">Leaderboard</a>
      </div>
    </div>
  </div>

  <!-- top info -->
  <div class="card">
    <div class="row">
      <div>
        <h2 id="titleHeader" style="margin:0">EXIST GAMER — Solo Tournament</h2>
        <p id="desc" class="muted" style="margin-top:8px"></p>

        <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
          <div class="info-block">
            <span class="small">UPI</span>
            <div class="kv" id="infoUpi">-</div>
          </div>

          <div class="info-block">
            <span class="small">Room</span>
            <div class="kv" id="infoRoom">Not set</div>
          </div>

          <div class="info-block">
            <span class="small">Slots</span>
            <div class="kv" id="slotsInfo">0 filled</div>
          </div>

          <div class="info-block">
            <span class="small">Registration</span>
            <div class="kv" id="regInfo">Open</div>
          </div>
        </div>
      </div>

      <!-- Right side: quick actions -->
      <div>
        <div class="card" style="padding:12px;">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="small">Entry</div>
              <div class="kv" id="feeInfo">₹0</div>
            </div>
            <div>
              <div class="small">Per Kill</div>
              <div class="kv" id="pkill">₹0</div>
            </div>
          </div>

          <div style="height:10px"></div>
          <div class="controls">
            <button class="btn btn-primary" onclick="openUPIBlock()">Pay & Register</button>
            <a class="btn btn-ghost" href="verify.html">Verify</a>
          </div>

          <div class="hint">Note: Admin changes saved in browser localStorage. Use same device to manage & verify.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- main content: register + players -->
  <div class="row" style="margin-top:10px">
    <!-- left: register -->
    <div class="card">
      <h3 style="margin:0 0 8px 0">Register</h3>
      <div class="muted">Enter your details then press <strong>Pay & Register</strong>. QR will appear below.</div>

      <div style="height:10px"></div>
      <label class="small">Free Fire Name</label>
      <input id="rName" placeholder="Your in-game name">

      <label class="small">UID</label>
      <input id="rUid" placeholder="e.g. 123456789">

      <label class="small">WhatsApp</label>
      <input id="rWp" placeholder="10-digit number">

      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn btn-primary" onclick="regNow()">Pay & Register</button>
        <button class="btn btn-ghost" onclick="clearRegForm()">Clear</button>
      </div>

      <div id="qrArea" style="display:none;margin-top:12px;text-align:center">
        <img id="qrImg" src="aryan-upi-qr.png" alt="QR" style="width:220px;border-radius:12px;border:1px solid var(--glass)">
        <div style="height:8px"></div>
        <button class="btn btn-primary" onclick="openUPI()">Open UPI App</button>
        <div class="muted" style="margin-top:8px">After payment, admin will verify and mark Paid.</div>
      </div>
    </div>

    <!-- right: registered players -->
    <div class="card">
      <h3 style="margin:0 0 8px 0">Registered Players</h3>

      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>#</th><th>Name</th><th>UID</th><th>WhatsApp</th><th>Code</th><th>Status</th><th class="admin-only">Actions</th></tr>
          </thead>
          <tbody id="playersTable"></tbody>
        </table>
      </div>

      <div style="height:10px"></div>
      <div class="muted">Tip: Long values are hidden for privacy. Admin can mark Paid or remove entries.</div>
    </div>
  </div>

  <!-- admin settings -->
  <div class="card admin-only" id="adminSettingsCard" style="margin-top:16px">
    <h3 style="margin:0 0 8px 0">Admin Settings</h3>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div>
        <label class="small">Tournament Name</label>
        <input id="setName">
      </div>
      <div>
        <label class="small">Map</label>
        <input id="setMap">
      </div>

      <div>
        <label class="small">Entry Fee (₹)</label>
        <input id="setFee" type="number" min="0">
      </div>
      <div>
        <label class="small">Slots</label>
        <input id="setSlots" type="number" min="1">
      </div>

      <div>
        <label class="small">Winner1 (₹)</label>
        <input id="setP1" type="number">
      </div>
      <div>
        <label class="small">Winner2 (₹)</label>
        <input id="setP2" type="number">
      </div>

      <div>
        <label class="small">Winner3 (₹)</label>
        <input id="setP3" type="number">
      </div>
      <div>
        <label class="small">Per Kill (₹)</label>
        <input id="setKill" type="number">
      </div>

      <div>
        <label class="small">UPI ID</label>
        <input id="setUpi" placeholder="9170856377-3@ybl">
      </div>
      <div>
        <label class="small">Registration</label>
        <select id="setReg"><option value="1">Open</option><option value="0">Closed</option></select>
      </div>

      <div>
        <label class="small">Room ID</label>
        <input id="setRoomId" placeholder="e.g. 123456">
      </div>
      <div>
        <label class="small">Room Password</label>
        <div style="display:flex;gap:8px">
          <input id="setRoomPass" placeholder="password">
          <button id="toggleRoomShow" class="btn btn-ghost" style="padding:8px 10px" onclick="toggleRoomMask()">Show</button>
        </div>
      </div>
    </div>

    <div style="height:12px"></div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
      <button class="btn btn-ghost" onclick="importSample()">Import Sample Players</button>
      <button class="btn btn-danger" onclick="clearAll()">Clear Players</button>
      <button class="btn btn-ghost" onclick="adminLogout()">Logout Admin</button>
    </div>
    <div class="hint">Admin mode: unlock with PIN via the top Admin button. Changes saved to browser localStorage.</div>
  </div>

</div>

<!-- floating admin button for quick access on all pages (visible only when not admin) -->
<button id="adminFloating" onclick="tryAdmin()" title="Admin">Admin</button>

<script>
/* ======================
   SETTINGS & STORAGE KEYS
   ====================== */
const SKEY = "existG_settings_v2";
const PKEY = "existG_players_v2";
const LKEY = "existG_lb_v2";

/* default settings */
const DEFAULTS = {
  name: "EXIST GAMER",
  map: "Bermuda",
  fee: 25,
  slots: 48,
  p1: 150, p2: 100, p3: 50,
  perKill: 6,
  upi: "9170856377-3@ybl",
  regOpen: 1,
  roomId: "",
  roomPass: ""
};

/* ADMIN PIN - change this to your secret */
const ADMIN_PIN = "786786";

/* check admin flag from localStorage */
let IS_ADMIN = localStorage.getItem("exist_isAdmin") === "1";

/* app data */
let settings = {...DEFAULTS};
let players = [];

/* init */
(function init(){
  // load saved
  try {
    const s = JSON.parse(localStorage.getItem(SKEY) || "null");
    const p = JSON.parse(localStorage.getItem(PKEY) || "null");
    if(s) settings = {...settings, ...s};
    if(p) players = p;
  } catch(e){
    console.warn("load error", e);
  }

  // hide floating button if admin already
  document.getElementById('adminFloating').style.display = IS_ADMIN ? 'none' : 'block';

  applySettingsToUI();

  if(IS_ADMIN){
    // reveal admin elements
    document.querySelectorAll('.admin-only').forEach(x => x.style.display = 'block');
    loadAdminForm();
  }
})();

/* UI apply */
function applySettingsToUI(){
  document.getElementById("titleHeader").textContent = `${settings.name} — Solo`;
  document.getElementById("desc").textContent = `Mode: Solo • Map: ${settings.map} • Prizes: ${settings.p1}/${settings.p2}/${settings.p3}`;
  document.getElementById("infoUpi").textContent = settings.upi;
  document.getElementById("feeInfo").textContent = `₹${settings.fee}`;
  document.getElementById("pkill").textContent = `₹${settings.perKill}`;
  document.getElementById("slotsInfo").textContent = `Slots: ${settings.slots} • Filled: ${players.length}`;
  document.getElementById("regInfo").textContent = settings.regOpen ? "Open" : "Closed";

  if(settings.roomId){
    document.getElementById("infoRoom").textContent = `${settings.roomId} (${settings.roomPass ? "set" : "no pass"})`;
  } else {
    document.getElementById("infoRoom").textContent = "Not set";
  }

  renderPlayersTable();
}

/* render players */
function renderPlayersTable(){
  const tbody = document.getElementById("playersTable");
  if(!tbody) return;
  let html = "";
  players.forEach((p,i)=>{
    html += `<tr>
      <td>${i+1}</td>
      <td class="wrap-allow" style="text-align:left">${escapeHtml(p.name)}</td>
      <td>${hideValue(p.uid)}</td>
      <td>${hideValue(p.wp)}</td>
      <td>${escapeHtml(p.code)}</td>
      <td>${p.paid ? '<span class="status-paid">Paid</span>' : '<span class="status-pend">Pending</span>'}</td>
      <td class="admin-only">
         <button class="btn btn-primary" onclick="markPaid(${i})">Paid</button>
         <button class="btn btn-ghost" onclick="viewPlayer(${i})">View</button>
         <button class="btn btn-danger" onclick="deletePlayer(${i})">Delete</button>
      </td>
    </tr>`;
  });
  tbody.innerHTML = html || `<tr><td colspan="7" class="muted">No players registered yet.</td></tr>`;
}

/* helpers */
function hideValue(s){
  s = (s||"")+"";
  if(!s) return "";
  if(s.length <= 4) return "•••" + s;
  return "•••" + s.slice(-4);
}
function escapeHtml(s){ return (""+s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* Register flow */
function clearRegForm(){
  document.getElementById("rName").value = "";
  document.getElementById("rUid").value = "";
  document.getElementById("rWp").value = "";
}

function regNow(){
  if(!settings.regOpen){
    return alert("Registration is closed by admin.");
  }
  const name = document.getElementById("rName").value.trim();
  const uid = document.getElementById("rUid").value.trim();
  const wp = document.getElementById("rWp").value.trim();
  if(!name || !uid || !wp) return alert("Please fill all fields.");

  if(wp.length < 8) return alert("Enter a valid WhatsApp number.");

  const code = (Date.now().toString(36).slice(-4) + Math.random().toString(36).slice(2,4)).toUpperCase();
  players.push({name, uid, wp, code, paid: 0});
  localStorage.setItem(PKEY, JSON.stringify(players));
  applySettingsToUI();

  document.getElementById("qrArea").style.display = "block";
  setTimeout(()=>document.getElementById("qrArea").scrollIntoView({behavior:"smooth"}),200);
  alert("Registered. Scan QR or open UPI to pay.");
}

/* UPI deep link and QR (opens UPI app if supported) */
function openUPI(){
  const upi = settings.upi || DEFAULTS.upi;
  const amt = settings.fee || DEFAULTS.fee;
  const tn = "Tournament Fee";
  const link = `upi://pay?pa=${encodeURIComponent(upi)}&pn=${encodeURIComponent(settings.name||DEFAULTS.name)}&am=${encodeURIComponent(amt)}&cu=INR&tn=${encodeURIComponent(tn)}`;
  location.href = link;
}
function openUPIBlock(){ document.getElementById("qrArea").style.display = "block"; document.getElementById("qrArea").scrollIntoView({behavior:"smooth"}); }

/* ===== admin show/hide helper ===== */
function setAdminVisible(on){
  // add/remove a style tag that forces .admin-only to show
  let el = document.getElementById('admin-override');
  if(on){
    if(!el){
      el = document.createElement('style');
      el.id = 'admin-override';
      el.innerText = '.admin-only{display:block !important;}';
      document.head.appendChild(el);
    }
    // reveal admin-only nodes (in case some need extra show)
    document.querySelectorAll('.admin-only').forEach(x => x.style.display = 'block');
    // hide floating admin button
    const af = document.getElementById('adminFloating');
    if(af) af.style.display = 'none';
  } else {
    if(el) el.remove();
    // hide admin nodes
    document.querySelectorAll('.admin-only').forEach(x => x.style.display = 'none');
    // show floating admin button
    const af = document.getElementById('adminFloating');
    if(af) af.style.display = 'block';
  }
}

/* ADMIN: unlock via PIN prompt (REPLACE your old tryAdmin) */
function tryAdmin(){
  try{
    const pin = prompt("Enter Admin PIN:");
    if(pin === null) return; // cancelled
    if(pin === ADMIN_PIN){
      localStorage.setItem("exist_isAdmin","1");
      IS_ADMIN = true;
      // force admin UI visible (overrides previous CSS)
      setAdminVisible(true);
      loadAdminForm();
      alert("Admin mode activated.");
    } else {
      alert("Wrong PIN.");
    }
  }catch(e){
    console.error(e);
    alert("Error: " + e.message);
  }
}

/* ADMIN logout (REPLACE your old adminLogout) */
function adminLogout(){
  try {
    localStorage.removeItem('exist_isAdmin');
  } catch(e){ console.warn(e) }
  IS_ADMIN = false;
  setAdminVisible(false);
  alert("Admin logged out.");
}

/* Admin form load/save */
function loadAdminForm(){
  document.getElementById("setName").value = settings.name || "";
  document.getElementById("setMap").value = settings.map || "";
  document.getElementById("setFee").value = settings.fee || "";
  document.getElementById("setSlots").value = settings.slots || "";
  document.getElementById("setP1").value = settings.p1 || "";
  document.getElementById("setP2").value = settings.p2 || "";
  document.getElementById("setP3").value = settings.p3 || "";
  document.getElementById("setKill").value = settings.perKill || "";
  document.getElementById("setUpi").value = settings.upi || "";
  document.getElementById("setReg").value = settings.regOpen ? "1" : "0";
  document.getElementById("setRoomId").value = settings.roomId || "";
  document.getElementById("setRoomPass").value = settings.roomPass || "";
  document.getElementById("toggleRoomShow").textContent = "Show";
  document.getElementById("setRoomPass").type = "password";
}
function toggleRoomMask(){
  const el = document.getElementById("setRoomPass");
  const btn = document.getElementById("toggleRoomShow");
  if(!el) return;
  if(el.type === "password"){ el.type = "text"; btn.textContent = "Hide"; } else { el.type = "password"; btn.textContent = "Show"; }
}
function saveSettings(){
  settings.name = document.getElementById("setName").value || settings.name;
  settings.map = document.getElementById("setMap").value || settings.map;
  settings.fee = Number(document.getElementById("setFee").value) || settings.fee;
  settings.slots = Number(document.getElementById("setSlots").value) || settings.slots;
  settings.p1 = Number(document.getElementById("setP1").value) || settings.p1;
  settings.p2 = Number(document.getElementById("setP2").value) || settings.p2;
  settings.p3 = Number(document.getElementById("setP3").value) || settings.p3;
  settings.perKill = Number(document.getElementById("setKill").value) || settings.perKill;
  settings.upi = document.getElementById("setUpi").value || settings.upi;
  settings.regOpen = Number(document.getElementById("setReg").value);
  settings.roomId = document.getElementById("setRoomId").value || settings.roomId;
  settings.roomPass = document.getElementById("setRoomPass").value || settings.roomPass;

  localStorage.setItem(SKEY, JSON.stringify(settings));
  applySettingsToUI();
  alert("Settings saved.");
}

/* admin utilities */
function importSample(){
  players = [
    {name:"Inferno", uid:"3889662216", wp:"917000000001", code:"A1B2C3", paid:1},
    {name:"Action Bolt", uid:"4344524799", wp:"917000000002", code:"D4E5F6", paid:0},
    {name:"V1BRANT", uid:"2807715845", wp:"917000000003", code:"G7H8I9", paid:1}
  ];
  localStorage.setItem(PKEY, JSON.stringify(players));
  applySettingsToUI();
  alert("Sample players imported.");
}

function clearAll(){
  if(!confirm("Clear all registered players?")) return;
  players = [];
  localStorage.removeItem(PKEY);
  applySettingsToUI();
}

/* per-player admin actions */
function markPaid(i){
  players[i].paid = 1;
  localStorage.setItem(PKEY, JSON.stringify(players));
  applySettingsToUI();
}
function deletePlayer(i){
  if(!confirm("Delete this player?")) return;
  players.splice(i,1);
  localStorage.setItem(PKEY, JSON.stringify(players));
  applySettingsToUI();
}
function viewPlayer(i){
  const p = players[i];
  alert(`Name: ${p.name}\nUID: ${p.uid}\nWhatsApp: ${p.wp}\nCode: ${p.code}\nStatus: ${p.paid ? 'Paid' : 'Pending'}`);
}

/* utilities for verify page or external use */
function getSettingsForExternal(){
  return JSON.parse(localStorage.getItem(SKEY) || "{}");
}
function getPlayersForExternal(){
  return JSON.parse(localStorage.getItem(PKEY) || "[]");
}

/* small safety: prevent errors leaking */
window.addEventListener("error", function(e){ console.warn("client error:", e.message); });

// end script
</script>
</body>
</html>
