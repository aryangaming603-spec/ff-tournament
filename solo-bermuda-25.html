<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Room Verification - EXIST GAMER</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{margin:0;background:#020d18;color:#dff6ff;font-family:Arial;padding:16px}
  .card{background:#071826;padding:16px;border-radius:10px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.06)}
  input{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:#041826;color:#eaffff}
  button{padding:10px 14px;border:none;border-radius:6px;font-weight:700;margin-top:10px;cursor:pointer}
  .btn-verify{background:#16a34a;color:#02120a;width:100%}
  .btn-copy{background:#2563eb;color:#fff;width:100%}
  .msg{margin-top:12px;font-weight:700}
  .small{font-size:13px;color:#9fbfcc}
  .k{color:#ffd166}
  .good{color:#34d399}
  .bad{color:#ff6b6b}
</style>
</head>
<body>

<h2 style="text-align:center;margin-bottom:20px">Room Verification</h2>

<div id="verifyRoom" class="card">Loading room details...</div>

<script>
/*
  Verify by UID version (updated):
  - shows room password unmasked
  - shows player name, uid, status
  - shows prize settings (p1,p2,p3, perKill)
*/
const SETTINGS_KEY = "existG_settings_v2";
const PLAYERS_KEY = "existG_players_v2";

(function(){
  const box = document.getElementById("verifyRoom");
  if(!box) return;

  // load settings and players from localStorage
  let settings = {};
  try{ settings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || "{}"); }catch(e){ settings = {}; }
  let players = [];
  try{ players = JSON.parse(localStorage.getItem(PLAYERS_KEY) || "[]"); }catch(e){ players = []; }

  const rid = settings.roomId || "";
  const rpass = settings.roomPass || "";
  const isFree = !!settings.isFree;

  if(!rid){
    box.innerHTML = '<div style="color:#ffd166">Room details not set by admin.</div>';
    return;
  }

  // show UI: room, prizes, input for UID
  box.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div>
        <div style="font-size:18px;font-weight:700">Room ID: <span style="color:#34d399">${rid}</span></div>
        <div class="small" style="margin-top:6px">Password: <strong style="color:#ffd166">${rpass || "(no password set)"}</strong></div>
      </div>
      <div style="text-align:right" class="small">
        <div>Prizes:</div>
        <div>1st: ₹${settings.p1 || 0}</div>
        <div>2nd: ₹${settings.p2 || 0}</div>
        <div>3rd: ₹${settings.p3 || 0}</div>
        <div style="margin-top:6px">Per Kill: ₹${settings.perKill || 0}</div>
      </div>
    </div>

    <div class="small" style="margin-top:8px;margin-bottom:6px">Enter your UID to verify (the UID you used during registration)</div>
    <input id="userUid" placeholder="Enter your Free Fire UID (numbers only)">

    <button id="verifyBtn" class="btn-verify">Verify</button>
    <button id="copyRoomBtn" class="btn-copy">Copy Room Details</button>

    <div id="verifyMsg" class="msg"></div>
    <div id="playerInfo" style="margin-top:10px;color:#9fbfcc"></div>
  `;

  const verifyBtn = document.getElementById('verifyBtn');
  const copyBtn = document.getElementById('copyRoomBtn');
  const msg = document.getElementById('verifyMsg');
  const pinfo = document.getElementById('playerInfo');

  verifyBtn.addEventListener('click', ()=> {
    const input = (document.getElementById('userUid')||{}).value.trim();
    msg.textContent = '';
    pinfo.textContent = '';

    if(!input){
      msg.style.color = '#ff6b6b'; msg.textContent = 'Enter your UID.'; return;
    }

    // normalize UID to digits-only
    const norm = input.replace(/\D/g,'');

    // find player by uid (exact match)
    const found = players.find(p => (''+p.uid).replace(/\D/g,'') === norm);

    if(!found){
      msg.style.color = '#ff6b6b';
      msg.textContent = 'Not registered for this tournament.';
      return;
    }

    // show player summary (name, uid, status)
    pinfo.innerHTML = `
      <div><strong>Name:</strong> ${escapeHtml(found.name || '(no name)')}</div>
      <div><strong>UID:</strong> ${escapeHtml(found.uid)}</div>
      <div><strong>Status:</strong> ${escapeHtml(found.status || 'N/A')}</div>
    `;

    // if tournament is paid and player status not Paid -> reject
    if(!isFree && (''+(found.status||'')).toLowerCase() !== 'paid'){
      msg.style.color = '#ff6b6b';
      msg.textContent = 'Payment not verified. Contact admin.';
      return;
    }

    // success - show password (unmasked) and allow copy join info
    msg.style.color = '#34d399';
    msg.textContent = 'Verified ✅ You can join the room. Password is shown above.';
  });

  copyBtn.addEventListener('click', ()=>{
    const text = `Room ID: ${rid}${rpass ? " | Password: " + rpass : ""}`;
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(text).then(()=> {
        const m = document.getElementById('verifyMsg');
        m.style.color = '#34d399'; m.textContent = 'Copied room details to clipboard.';
      }).catch(()=> alert(text));
    } else alert(text);
  });

  // small helper to escape HTML before inserting
  function escapeHtml(s){
    return (''+s).replace(/[&<>"']/g,m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

})();
</script>

</body>
</html>
