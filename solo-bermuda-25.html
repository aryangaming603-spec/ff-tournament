<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>EXIST GAMER — Solo Tournament</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  /* safe responsive reset */
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#071026;color:#e6eef6;font-family:Inter,Arial,Helvetica,sans-serif}
  header{padding:16px;text-align:center;background:linear-gradient(180deg,#04263a,#071026);border-bottom:1px solid rgba(255,255,255,0.03)}
  header h1{margin:0;font-size:20px;color:#9be7ff}
  header p{margin:6px 0 0;color:#9ca3af;font-size:13px}

  .wrap{max-width:1100px;margin:18px auto;padding:12px}
  .row{display:flex;gap:14px;flex-wrap:wrap}
  .col{flex:1;min-width:300px}
  .card{background:linear-gradient(180deg,rgba(8,18,30,0.7),rgba(2,6,23,0.85));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 26px rgba(0,0,0,0.45);overflow:hidden}
  h2{margin:0 0 8px;color:#8fe0ff}
  p{margin:6px 0;color:#cbd5e1}
  .small{font-size:13px;color:#9ca3af}

  label{display:block;margin-top:8px;color:#9ca3af;font-size:13px}
  input[type="text"], input[type="number"], input[type="datetime-local"], select, textarea{
    width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#061024;color:#e6eef6;margin-top:6px;font-size:14px;
  }

  .btn{display:inline-block;padding:10px 14px;border-radius:9px;border:none;cursor:pointer;font-weight:700}
  .btn-primary{background:#16a34a;color:#04200e}
  .btn-accent{background:#2563eb;color:#eaf2ff}
  .btn-grey{background:#475569;color:#eaf2ff}
  .btn-danger{background:#dc2626;color:#fff}

  .table-wrap{overflow-x:auto;margin-top:10px}
  table{width:100%;border-collapse:collapse;min-width:640px}
  th,td{padding:8px;border:1px solid rgba(255,255,255,0.03);text-align:left;font-size:13px}
  th{background:rgba(6,18,30,0.6);color:#aeefff;font-weight:700;position:sticky;top:0;z-index:1}

  .status-paid{background:#16a34a;color:#04200e;padding:6px;border-radius:6px;font-weight:700}
  .status-pending{background:#f97316;color:#2b0500;padding:6px;border-radius:6px;font-weight:700}
  .rank1{background:#fde047;color:#111827;font-weight:700}
  .rank2{background:#cbd5e1;color:#111827;font-weight:700}
  .rank3{background:#fca5a5;color:#111827;font-weight:700}

  .settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media(max-width:780px){ .settings-grid{grid-template-columns:1fr} .row{flex-direction:column} table{min-width:520px} }
  @media(max-width:520px){ header h1{font-size:18px} }

  /* --- Mobile compact tweaks --- */
@media (max-width: 700px) {

  html, body {
    padding: 0 !important;
    margin: 0 !important;
    overflow-x: hidden !important;
  }

  .wrap { padding: 8px !important; }
  .card { padding: 10px !important; margin-bottom: 12px !important; border-radius: 10px; }
  header { padding: 12px !important; }
  header h1 { font-size: 18px !important; }
  h2 { font-size: 16px !important; }
  .small { font-size: 12px !important; }

  input, select, textarea {
    padding: 8px !important;
    font-size: 14px !important;
  }

  .btn {
    padding: 9px 10px !important;
    font-size: 14px !important;
  }

  /* tables internal scroll (reduce webpage height) */
  .table-wrap {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
    max-height: 260px;
  }

  table { min-width: auto !important; }
  th, td { padding: 6px !important; font-size: 13px !important; }

  /* ellipsis for long names */
  td:nth-child(2), th:nth-child(2) {
    max-width: 120px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* admin settings hide on phone */
  #adminSettingsCard { display: none !important; }
  #lbAdmin { display: none !important; }

  /* modal responsive */
  #upiModal > div {
    max-height: 88vh;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }
}
</style>
</head>
<body>
<header>
  <h1 id="titleHeader">EXIST GAMER — Solo Tournament</h1>
  <p id="subtitle">Organized by EXIST GAMER • Admin: add <code>?admin=1</code></p>
</header>

<div class="wrap">
  <div class="row">
    <div class="col">
      <div class="card" id="infoCard">
        <h2>Tournament Info</h2>
        <p class="small" id="infoText">Loading settings…</p>
        <p class="small">UPI: <span id="infoUpi" style="color:#34d399;font-weight:700">9170856377-3@ybl</span></p>
        <p class="small" id="slotsInfo">Slots: 48 • Filled: 0</p>
      </div>

      <div class="card" id="registerCard">
        <h2>Register & Pay</h2>
        <div id="regNotice" class="small">Registration status unknown</div>

        <label>Free Fire Name</label>
        <input id="ffName" type="text" placeholder="Your in-game name">

        <label>UID</label>
        <input id="ffUid" type="text" placeholder="1234567890">

        <label>WhatsApp</label>
        <input id="ffWa" type="text" placeholder="10-digit number">

        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn btn-primary" onclick="payAndRegister()">Pay & Register</button>
        </div>

        <p class="small" style="margin-top:8px">After registering you'll see a QR & UPI code — scan or copy and then press "Open UPI app" to pay.</p>
      </div>

      <div class="card">
        <h2>Registered Players</h2>
        <div class="table-wrap">
          <table aria-live="polite">
            <thead>
              <tr><th style="width:48px">#</th><th>Name</th><th>UID</th><th>WhatsApp</th><th>Code</th><th>Status / Actions</th></tr>
            </thead>
            <tbody id="playerList"></tbody>
          </table>
        </div>
        <p class="small" id="playersNote">Players stored in browser. Admin can manage them.</p>
      </div>
    </div>

    <div class="col">
      <div class="card" id="adminSettingsCard" style="display:none">
        <h2>Admin Settings (Edit live)</h2>
        <p class="small">Change tournament details here. Changes save locally (this browser) and apply instantly.</p>

        <div class="settings-grid">
          <div>
            <label>Tournament Name</label>
            <input id="setName" type="text">
          </div>

          <div>
            <label>Mode</label>
            <input id="setMode" type="text" placeholder="Solo/Duo/Squad">
          </div>

          <div>
            <label>Map</label>
            <input id="setMap" type="text" placeholder="Bermuda">
          </div>

          <div>
            <label>Total Slots</label>
            <input id="setSlots" type="number" min="1">
          </div>

          <div>
            <label>Entry Fee (₹)</label>
            <input id="setFee" type="number" min="0">
          </div>

          <div>
            <label>Is Free?</label>
            <select id="setFree"><option value="0">No (Paid)</option><option value="1">Yes (Free)</option></select>
          </div>

          <div>
            <label>Winner 1 (₹)</label>
            <input id="setP1" type="number" min="0">
          </div>

          <div>
            <label>Winner 2 (₹)</label>
            <input id="setP2" type="number" min="0">
          </div>

          <div>
            <label>Winner 3 (₹)</label>
            <input id="setP3" type="number" min="0">
          </div>

          <div>
            <label>Per Kill (₹)</label>
            <input id="setKill" type="number" min="0">
          </div>

          <div>
            <label>UPI ID</label>
            <input id="setUpi" type="text">
          </div>

          <div>
            <label>Registration</label>
            <select id="setReg"><option value="1">Open</option><option value="0">Closed</option></select>
          </div>

          <div>
            <label>Countdown (optional)</label>
            <input id="setCountdown" type="datetime-local">
          </div>

          <div>
            <label>Primary Color</label>
            <input id="setColor" type="color" value="#16a34a">
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn btn-accent" onclick="saveSettings()">Save Settings</button>
          <button class="btn btn-grey" onclick="resetSettings()">Reset Defaults</button>
          <button class="btn btn-danger" onclick="clearAllData()">Clear Players & LB</button>
        </div>
        <p class="small" id="saveNote"></p>
      </div>

      <div class="card">
        <h2>Leaderboard</h2>
        <p class="small">Top 3 prizes shown automatically. Admin can add/edit/remove results.</p>

        <div id="lbAdmin" style="display:none;margin-top:8px;">
          <label>Player Name</label><input id="lb_name" type="text" placeholder="Player name">
          <label>Kills</label><input id="lb_kills" type="number" placeholder="0">
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn btn-accent" onclick="lbAdd()">Add</button>
            <button class="btn btn-grey" onclick="lbClear()">Reset LB</button>
          </div>
        </div>

        <div class="table-wrap" style="margin-top:10px">
          <table>
            <thead><tr><th style="width:64px">Rank</th><th>Name</th><th style="width:90px">Kills</th><th style="width:140px">Reward</th></tr></thead>
            <tbody id="lb_table"></tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- UPI Modal (QR image must be uploaded to repo as aryan-upi-qr.png) -->
<div id="upiModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:9999;align-items:center;justify-content:center;">
  <div style="width:94%;max-width:440px;background:#071026;padding:16px;border-radius:12px;color:#e6eef6;">
    <h3 style="margin:0 0 8px;">Payment options</h3>
    <p style="margin:0 0 10px;color:#9ca3af;font-size:13px">Scan the QR or copy UPI details & code. Then press "Open UPI app" to pay (mobile).</p>

    <div style="text-align:center;margin-bottom:10px;">
      <img id="upiQrImg" src="aryan-upi-qr.png" alt="UPI QR" style="max-width:200px;border-radius:8px;border:1px solid #123;">
      <div style="margin-top:8px;font-size:13px;color:#cbd5e1;">Scan to pay</div>
    </div>

    <div style="background:#061026;padding:10px;border-radius:8px;margin-bottom:10px;">
      <div style="font-size:13px;color:#9ca3af;">UPI ID</div>
      <div id="upiIdDisplay" style="font-weight:700;margin-top:6px;">9170856377-3@ybl</div>

      <div style="margin-top:8px;font-size:13px;color:#9ca3af;">Payment Code</div>
      <div id="upiCodeDisplay" style="font-weight:700;margin-top:6px;">XXXXX</div>

      <button onclick="copyUPIInfo()" style="margin-top:10px;padding:10px;border-radius:8px;border:none;background:#22c55e;color:#04200e;font-weight:700;width:100%;">Copy UPI & Code</button>
    </div>

    <div style="display:flex;gap:8px;">
      <button id="openUpiBtn" onclick="openUpiApp()" style="flex:1;padding:10px;border-radius:8px;border:none;background:#2563eb;color:#eaf2ff;font-weight:700;">Open UPI app</button>
      <a id="waLink" href="#" target="_blank" style="text-decoration:none">
        <button style="padding:10px;border-radius:8px;border:none;background:#25D366;color:#04200e;font-weight:700;">Send via WhatsApp</button>
      </a>
      <button onclick="closeUpiModal()" style="padding:10px;border-radius:8px;border:none;background:#64748b;color:#fff;">Close</button>
    </div>

    <p style="margin-top:8px;font-size:12px;color:#9ca3af;">If your UPI app shows QR/scan suggestion, choose "Pay using UPI ID" or scan the QR above.</p>
  </div>
</div>

<script>
/* KEYS & DEFAULTS */
const SETTINGS_KEY = "existG_settings_v1";
const PLAYERS_KEY = "existG_players_v1";
const LB_KEY = "existG_lb_v1";

const DEFAULTS = {
  name: "EXIST GAMER",
  mode: "Solo",
  map: "Bermuda",
  slots: 48,
  fee: 25,
  isFree: false,
  regOpen: true,
  p1: 150,
  p2: 100,
  p3: 50,
  perKill: 6,
  upi: "9170856377-3@ybl",
  countdown: "",
  primary: "#16a34a"
};

/* STATE */
let settings = {};
let players = JSON.parse(localStorage.getItem(PLAYERS_KEY) || "[]");
let leaderboard = JSON.parse(localStorage.getItem(LB_KEY) || "[]");
const IS_ADMIN = window.location.search.includes("admin=1");

/* UTIL */
function savePlayers(){ localStorage.setItem(PLAYERS_KEY, JSON.stringify(players)); }
function saveLB(){ localStorage.setItem(LB_KEY, JSON.stringify(leaderboard)); }
function saveSettingsStorage(){ localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings)); }
function escapeHtml(s){ return (''+s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }

/* SETTINGS FUNCTIONS */
function loadSettings(){
  try{
    const s = JSON.parse(localStorage.getItem(SETTINGS_KEY));
    settings = s && typeof s === "object" ? {...DEFAULTS, ...s} : {...DEFAULTS};
  }catch(e){ settings = {...DEFAULTS}; }
  applySettingsToUI();
}

function applySettingsToUI(){
  document.getElementById("titleHeader").textContent = (settings.name || DEFAULTS.name) + " — Tournament";
  document.getElementById("subtitle").textContent = `${settings.mode} • ${settings.map} • Entry ₹${settings.fee}`;
  document.getElementById("infoText").textContent = `${settings.mode} • Map: ${settings.map} • Entry: ₹${settings.fee} • Kill: ₹${settings.perKill} • Prizes: ${settings.p1}/${settings.p2}/${settings.p3}`;
  document.getElementById("infoUpi").textContent = settings.upi;
  document.getElementById("infoUpi").setAttribute("title", settings.upi);
  document.getElementById("infoUpi").style.color = settings.primary || DEFAULTS.primary;
  document.getElementById("slotsInfo").textContent = `Slots: ${settings.slots} • Filled: ${players.length}`;

  // registration notice
  document.getElementById("regNotice").textContent = settings.regOpen ? "Registration OPEN" : "Registration CLOSED";

  // admin UI fill
  if(IS_ADMIN){
    document.getElementById("adminSettingsCard").style.display = "block";
    document.getElementById("setName").value = settings.name;
    document.getElementById("setMode").value = settings.mode;
    document.getElementById("setMap").value = settings.map;
    document.getElementById("setSlots").value = settings.slots;
    document.getElementById("setFee").value = settings.fee;
    document.getElementById("setFree").value = settings.isFree ? "1":"0";
    document.getElementById("setP1").value = settings.p1;
    document.getElementById("setP2").value = settings.p2;
    document.getElementById("setP3").value = settings.p3;
    document.getElementById("setKill").value = settings.perKill;
    document.getElementById("setUpi").value = settings.upi;
    document.getElementById("setReg").value = settings.regOpen ? "1":"0";
    document.getElementById("setCountdown").value = settings.countdown || "";
    document.getElementById("setColor").value = settings.primary || DEFAULTS.primary;
    // show lb admin
    document.getElementById("lbAdmin").style.display = "block";
  } else {
    document.getElementById("adminSettingsCard").style.display = "none";
    document.getElementById("lbAdmin").style.display = "none";
  }
}

/* Save & reset */
function saveSettings(){
  settings.name = document.getElementById("setName").value || DEFAULTS.name;
  settings.mode = document.getElementById("setMode").value || DEFAULTS.mode;
  settings.map = document.getElementById("setMap").value || DEFAULTS.map;
  settings.slots = parseInt(document.getElementById("setSlots").value) || DEFAULTS.slots;
  settings.fee = Number(document.getElementById("setFee").value) || DEFAULTS.fee;
  settings.isFree = document.getElementById("setFree").value === "1";
  settings.p1 = Number(document.getElementById("setP1").value) || DEFAULTS.p1;
  settings.p2 = Number(document.getElementById("setP2").value) || DEFAULTS.p2;
  settings.p3 = Number(document.getElementById("setP3").value) || DEFAULTS.p3;
  settings.perKill = Number(document.getElementById("setKill").value) || DEFAULTS.perKill;
  settings.upi = document.getElementById("setUpi").value || DEFAULTS.upi;
  settings.regOpen = document.getElementById("setReg").value === "1";
  settings.countdown = document.getElementById("setCountdown").value || "";
  settings.primary = document.getElementById("setColor").value || DEFAULTS.primary;

  saveSettingsStorage();
  applySettingsToUI();
  alert("Settings saved");
}

function resetSettings(){
  if(!confirm("Reset settings to defaults?")) return;
  settings = {...DEFAULTS};
  saveSettingsStorage();
  applySettingsToUI();
  alert("Defaults restored");
}

/* PLAYERS */
function createCode(){ return "FF" + Math.floor(100000 + Math.random()*900000); }

function payAndRegister(){
  try{
    if(!settings.regOpen){ alert("Registration is closed"); return; }

    const name = (document.getElementById("ffName")||{}).value.trim();
    const uid = (document.getElementById("ffUid")||{}).value.trim();
    const wa = (document.getElementById("ffWa")||{}).value.trim();

    if(!name || !uid || !wa){ alert("Fill Name, UID & WhatsApp"); return; }
    if(players.length >= settings.slots){ alert("Slots full"); return; }

    const code = createCode();
    const status = settings.isFree ? "Paid" : "Pending";
    const entry = { name, uid, wa, code, status, ts: Date.now() };

    players.push(entry);
    savePlayers();

    // UI updates
    renderPlayers();
    applySettingsToUI();

    // clear form
    document.getElementById("ffName").value = "";
    document.getElementById("ffUid").value = "";
    document.getElementById("ffWa").value = "";

    // Show modal with QR & code; do not auto redirect
    showUpiModal(code);

    // prepare whatsapp fallback link (admin contact)
    const waMsg = encodeURIComponent(`Hi, I want to pay for EXIST GAMER tournament. Code: ${code}`);
    document.getElementById("waLink").href = `https://wa.me/919170856377?text=${waMsg}`;

  }catch(err){
    console.error("payAndRegister error:", err);
    alert("Error registering. See console.");
  }
}

/* Render players */
function renderPlayers(){
  const tbody = document.getElementById("playerList");
  tbody.innerHTML = "";
  players.forEach((p,i)=>{
    const statusHtml = IS_ADMIN
      ? `<button class="${p.status==='Paid'?'status-paid':'status-pending'}" onclick="togglePaid(${i})">${escapeHtml(p.status)}</button>`
      : `<span class="small">${escapeHtml(p.status)}</span>`;

    const adminActions = IS_ADMIN
      ? `<div style="margin-top:6px;display:flex;gap:6px;flex-wrap:wrap;">
           <button class="btn btn-accent" onclick="editPlayer(${i})">Edit</button>
           <button class="btn btn-danger" onclick="removePlayer(${i})">Remove</button>
         </div>`
      : "";

    const tr = document.createElement("tr");
    tr.innerHTML = `<td style="text-align:center">${i+1}</td>
      <td>${escapeHtml(p.name)}</td>
      <td>${IS_ADMIN?escapeHtml(p.uid):'XXXXXXX'}</td>
      <td>${IS_ADMIN?escapeHtml(p.wa):'XXXXXXXXXX'}</td>
      <td>${IS_ADMIN?escapeHtml(p.code):'XXXXXX'}</td>
      <td>${statusHtml}${adminActions}</td>`;
    tbody.appendChild(tr);
  });
}

/* admin player actions */
function togglePaid(i){
  if(!IS_ADMIN){ alert("Admin only"); return; }
  players[i].status = players[i].status === "Paid" ? "Pending" : "Paid";
  savePlayers(); renderPlayers(); applySettingsToUI();
}
function removePlayer(i){
  if(!IS_ADMIN){ alert("Admin only"); return; }
  if(!confirm("Remove player?")) return;
  players.splice(i,1); savePlayers(); renderPlayers(); applySettingsToUI();
}
function editPlayer(i){
  if(!IS_ADMIN){ alert("Admin only"); return; }
  const p = players[i];
  const n = prompt("Edit name:", p.name); if(n===null) return;
  const u = prompt("Edit UID:", p.uid); if(u===null) return;
  const w = prompt("Edit WhatsApp:", p.wa); if(w===null) return;
  p.name = n.trim()||p.name; p.uid = u.trim()||p.uid; p.wa = w.trim()||p.wa;
  savePlayers(); renderPlayers();
}

/* LEADERBOARD */
function lbRender(){
  const tbody = document.getElementById("lb_table");
  const sorted = [...leaderboard].sort((a,b)=>Number(b.kills)-Number(a.kills));
  let html = "";
  sorted.forEach((p,i)=>{
    let base = 0;
    if(i===0) base = settings.p1;
    else if(i===1) base = settings.p2;
    else if(i===2) base = settings.p3;
    const kills = Number(p.kills) || 0;
    const reward = base + (kills * settings.perKill);
    const rowClass = i===0 ? "rank1" : i===1 ? "rank2" : i===2 ? "rank3" : "";
    html += `<tr class="${rowClass}"><td style="text-align:center">${i+1}</td><td>${escapeHtml(p.name)}${IS_ADMIN?` <button class="btn btn-accent" onclick="lbEdit(${i})">Edit</button> <button class="btn btn-danger" onclick="lbRemove(${i})">Remove</button>`:""}</td><td style="text-align:center">${kills}</td><td style="text-align:center">₹${reward}</td></tr>`;
  });
  tbody.innerHTML = html;
}
function lbAdd(){ if(!IS_ADMIN){alert("Admin only");return;} const n=document.getElementById("lb_name").value.trim(); const k=parseInt(document.getElementById("lb_kills").value); if(!n||isNaN(k)){alert("Enter name & kills");return;} leaderboard.push({name:n,kills:k}); saveLB(); document.getElementById("lb_name").value=""; document.getElementById("lb_kills").value=""; lbRender(); }
function lbClear(){ if(!IS_ADMIN){alert("Admin only");return;} if(!confirm("Reset leaderboard?")) return; leaderboard=[]; saveLB(); lbRender(); }
function lbEdit(i){ if(!IS_ADMIN)return; const p=leaderboard[i]; const nn=prompt("Edit name:",p.name); if(nn===null) return; const nk=prompt("Edit kills:",p.kills); if(nk===null) return; leaderboard[i].name = nn.trim()||p.name; leaderboard[i].kills = isNaN(parseInt(nk))?p.kills:parseInt(nk); saveLB(); lbRender(); }
function lbRemove(i){ if(!IS_ADMIN)return; if(!confirm("Remove?")) return; leaderboard.splice(i,1); saveLB(); lbRender(); }

/* UPI Modal control */
let __LAST_UPI_URL = "";
let __LAST_PAY_CODE = "";

function showUpiModal(code){
  __LAST_PAY_CODE = code || "";
  const upiId = settings.upi || DEFAULTS.upi;
  document.getElementById('upiCodeDisplay').textContent = __LAST_PAY_CODE || "XXXXX";
  document.getElementById('upiIdDisplay').textContent = upiId;
  // whatsapp contact to admin
  document.getElementById('waLink').href = `https://wa.me/919170856377?text=${encodeURIComponent("Hi, I want to pay for EXIST GAMER. Code: " + __LAST_PAY_CODE)}`;

  __LAST_UPI_URL =
    "upi://pay?pa=" + encodeURIComponent(upiId) +
    "&pn=" + encodeURIComponent(settings.name || DEFAULTS.name) +
    "&am=" + encodeURIComponent(settings.fee || DEFAULTS.fee) +
    "&cu=INR&tn=" + encodeURIComponent(__LAST_PAY_CODE);

  const m = document.getElementById('upiModal');
  if(m) m.style.display = 'flex';
}
function closeUpiModal(){ const m=document.getElementById('upiModal'); if(m) m.style.display='none'; }
function openUpiApp(){ if(!__LAST_UPI_URL){ alert("No payment prepared."); return; } window.location.href = __LAST_UPI_URL; setTimeout(()=>{ alert("If UPI app didn't open, copy UPI & code and pay manually."); },900); }
function copyUPIInfo(){ const upi=document.getElementById('upiIdDisplay').textContent||DEFAULTS.upi; const code=document.getElementById('upiCodeDisplay').textContent||''; const txt=upi + " | Code: " + code; navigator.clipboard.writeText(txt).then(()=>alert("Copied UPI & Code. Paste in your UPI app to pay.")).catch(()=>prompt("Copy manually:", txt)); }

/* CLEAR ALL */
function clearAllData(){
  if(!IS_ADMIN){ alert("Admin only"); return; }
  if(!confirm("Clear ALL players and leaderboard?")) return;
  players=[]; leaderboard=[]; localStorage.removeItem(PLAYERS_KEY); localStorage.removeItem(LB_KEY);
  renderPlayers(); lbRender(); applySettingsToUI(); alert("Cleared");
}

/* INIT */
document.addEventListener("DOMContentLoaded", ()=> {
  loadSettings();
  // show admin settings area if admin
  if(IS_ADMIN){
    document.getElementById("adminSettingsCard").style.display = "block";
    document.getElementById("lbAdmin").style.display = "block";
  }
  renderPlayers();
  lbRender();

  // optional countdown
  if(settings.countdown){
    const target = new Date(settings.countdown).getTime();
    const intv = setInterval(()=>{
      const diff = target - Date.now();
      if(diff <= 0){ clearInterval(intv); document.getElementById("regNotice").textContent = "Match started"; return; }
      const h = Math.floor(diff/36e5), m = Math.floor((diff%36e5)/6e4), s = Math.floor((diff%6e4)/1000);
      document.getElementById("regNotice").textContent = `Match starts in ${h}h ${m}m ${s}s`;
    }, 1000);
  }
});

  // --- Mobile Admin Toggle Button ---
(function(){
  if (!window.location.search.includes("admin=1")) return; 
  if (window.innerWidth > 700) return;

  const btn = document.createElement('button');
  btn.textContent = "Admin";
  btn.style.position = "fixed";
  btn.style.right = "12px";
  btn.style.bottom = "12px";
  btn.style.zIndex = 99999;
  btn.style.padding = "8px 10px";
  btn.style.borderRadius = "8px";
  btn.style.border = "none";
  btn.style.background = "#2563eb";
  btn.style.color = "#fff";
  btn.style.fontWeight = "700";
  btn.style.boxShadow = "0 6px 18px rgba(0,0,0,0.4)";
  document.body.appendChild(btn);

  btn.addEventListener('click', function(){
    const adminCard = document.getElementById('adminSettingsCard');
    if(!adminCard) return alert("Admin panel not found.");
    if(adminCard.style.display === 'block'){
      adminCard.style.display = 'none';
      btn.textContent = "Admin";
    } else {
      adminCard.style.display = 'block';
      adminCard.scrollIntoView({behavior:'smooth', block:'center'});
      btn.textContent = "Hide";
    }
  });
})();
</script>
</body>
</html>
